<!DOCTYPE html>
<html>
<title>&nbsp;</title>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />	
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>	
	<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
				
	<style>
		#content {
		padding: 0;
		position : absolute !important; 
		top : 40px !important;  
		//top : 60px !important;  
		right : 0; 
		//bottom : 40px !important;  
		bottom : 0px !important;  
		left : 0 !important;     
		}
	</style>
	<style>
		@-moz-keyframes pulsate {
			from {
				-moz-transform: scale(0.25);
				opacity: 1.0;
			}
			95% {
				-moz-transform: scale(1.3);
				opacity: 0;
			}
			to {
				-moz-transform: scale(0.3);
				opacity: 0;
			}
		}
		@-webkit-keyframes pulsate {
			from {
				-webkit-transform: scale(0.25);
				opacity: 1.0;
			}
			95% {
				-webkit-transform: scale(1.3);
				opacity: 0;
			}
			to {
				-webkit-transform: scale(0.3);
				opacity: 0;
			}
		}
		/* get the container that's just outside the marker image, 
			which just happens to have our Marker title in it */
		#map_canvas div.gmnoprint[title="Current location"] {
			-moz-animation: pulsate 1.5s ease-in-out infinite;
			-webkit-animation: pulsate 1.5s ease-in-out infinite;
			border:1pt solid #fff;
			
			/* make a circle */
			-moz-border-radius:51px;
			-webkit-border-radius:51px;
			border-radius:51px;
			
			/* multiply the shadows, inside and outside the circle */
			-moz-box-shadow:inset 0 0 5px #06f, inset 0 0 5px #06f, inset 0 0 5px #06f, 0 0 5px #06f, 0 0 5px #06f, 0 0 5px #06f;
			-webkit-box-shadow:inset 0 0 5px #06f, inset 0 0 5px #06f, inset 0 0 5px #06f, 0 0 5px #06f, 0 0 5px #06f, 0 0 5px #06f;
			box-shadow:inset 0 0 5px #06f, inset 0 0 5px #06f, inset 0 0 5px #06f, 0 0 5px #06f, 0 0 5px #06f, 0 0 5px #06f;
			
			/* set the ring's new dimension and re-center it */
			height:51px!important;
			margin:-18px 0 0 -18px;
			width:51px!important;
		}
		
		/*	hide the superfluous marker image since it would expand and shrink with its containing element */
		/*	#map_canvas div[style*="987654"][title] img {*/
		#map_canvas div.gmnoprint[title="Current location"] img {
			display:none;
		}
		/* compensate for iPhone and Android devices with high DPI, add iPad media query */
		@media only screen and (-webkit-min-device-pixel-ratio: 1.5), only screen and (device-width: 768px) {
			#map_canvas div.gmnoprint[title="Current location"] {
				margin:-10px 0 0 -10px;
			}
		}
	</style>

	
	
    <script src="https://maps.googleapis.com/maps/api/js?sensor=true"></script>
    <script src="https://google-maps-utility-library-v3.googlecode.com/svn/trunk/geolocationmarker/src/geolocationmarker-compiled.js"></script>
    <script>
		/* http://google-maps-utility-library-v3.googlecode.com/svn/trunk/geolocationmarker/docs/reference.html */
		/* http://stackoverflow.com/questions/2564320/adding-ids-to-google-map-markers  - dynamically add title */
		/* GeoMarker.set('title', 'Current location'); */
		/* GeoMarker.set('title', ''); */
		var sampling = 0;
		var markers = [];
		var map, GeoMarker, lastmarker;
    
	
		// Create location
		function pt2location(lat, lng) {
			var loc = new google.maps.LatLng(lat, lng);
			return(loc);
			}
			
		// place marker, push
		function createmarker(location) {
			var marker = new google.maps.Marker({
				position: location,
				map: map,
				});
			//lastmarker = marker;	
			//markers.push(marker);		ingen PUSH!
			}	

		//--------------------------------------------------------------
		
		function initialize() {
			var mapOptions = {
				zoom: 16,
				center: new google.maps.LatLng(-34.397, 150.644),
				mapTypeId: google.maps.MapTypeId.ROADMAP
				};
			map = new google.maps.Map(document.getElementById('map_canvas'),
			mapOptions);
    
			GeoMarker = new GeolocationMarker();
			GeoMarker.setCircleOptions({fillColor: '#808080'});

			google.maps.event.addListener(GeoMarker, 'position_changed', function() {
				var len = markers.length;
				var oldZoom = map.getZoom();
				if (oldZoom > 16) { /*oldZoom = 16;*/ }
				
				// fitBounds when there was many points, and setCenter+setZoom when there was only one point.
				if (len > 1) {
					// dette fungerer ikke - zoomer helt inn!
					map.fitBounds(this.getBounds());
					/****
					var bounds = new google.maps.LatLngBounds();
					bounds.extend(position_1);
					bounds.extend(position_2);
					map.fitBounds(bounds);
					****/
					}
				else {
					// dette fungerer - riktig zoom (l√∏sning - ikke push til markers)
					//alert('len 1'); - kommer alltid hit!!!
					
					/**
					if (sampling == 0) { 
						// KUN 1. gangen!, ellers vises kart i australia
						// kommenter ut if statement hvis kart skal sentreres ved hvert nytt punkt!
						map.setCenter(this.getPosition()); 
						}
					**/
					
					map.setCenter(this.getPosition());  //nytt senter ved ny lokasjon istedenfor if over!
					map.setZoom(oldZoom);
					}
					
				// sampling
				if (sampling == 0) {
					sampling = 1;
					
					//var prevZoom = map.getZoom();
					var pos = GeoMarker.getPosition();
					var lat = pos.lat();
					var lng = pos.lng();
					var loc = pt2location(lat, lng);
					createmarker(loc);
					//map.setZoom(prevZoom);
					
					// timeout to next sampling
					google.maps.event.addListenerOnce(map,'idle',function() {
						window.setTimeout(function() {
							sampling = 0;
						},15000);
					});				
					} // sampling						
	
				}); // position_changed

				
			google.maps.event.addListener(GeoMarker, 'geolocation_error', function(e) {
				alert('There was an error obtaining your position. Message: ' + e.message);
			});
		
			GeoMarker.setMap(map);
			
				
			} // initialize

		google.maps.event.addDomListener(window, 'load', initialize);
      
		if(!navigator.geolocation) {
			alert('Your browser does not support geolocation');
		}
	</script>	
	<script>
		$(document).ready(function(){
			$("#siste").click(function(){
				alert('siste');
				$( "#myPanel-r" ).panel( "close" );
			});
			$("#alle").click(function(){
				alert('alle');
				$( "#myPanel-r" ).panel( "close" );
			});
			$("#linje").click(function(){
				alert('linje');
				$( "#myPanel-r" ).panel( "close" );
			});
			$("#start").click(function(){
				alert('start');
				//GeoMarker.set('title', 'Current location');
			});
			$("#stop").click(function(){
				alert('stop');
			});
		});
	</script>
	
</head>
	
<body>
	<div data-role="page" id="page1">
		<div data-role="panel" id="myPanel-r" data-display="overlay" data-position="right" data-theme="c">
			<ul data-role="listview" data-theme="d" data-icon="false">
				<li id="hdr" data-icon="delete" data-theme="b"><a href="#" data-rel="close">Tracking</a></li>
				<li id="siste" data-icon="check" class="ui-icon-alt" ><a href="#">Siste posisjon</a></li>
				<li id="alle" data-icon="" class="ui-icon-alt"><a href="#" >Alle posisjoner</a></li>
				<li id="linje" data-icon="home" class="ui-icon-alt"><a href="#" >Linje</a></li>
				<li id="tabell" data-icon="" class="ui-icon-alt"><a href="#page2" >Tabell</a></li>
			</ul>
		</div><!-- /panel -->
				
			
		<div data-theme="a" data-role="header">
			<a data-rel="back" data-ajax="false" data-icon="arrow-l">Tilbake</a>
			<h3>Page Header</h3>
			<a href="#myPanel-r" class="jqm-navmenu-link" data-icon="bars" data-iconpos="notext">Navigation</a>
		</div>
		
		<div data-role="content" id="content">
			<div id="result" style="height:20px; background-color:#666; color:white;padding-left:18px; font-size: 80%;">Tracking...</div>
			<div id="map_canvas" style="height:100%"></div>
		</div>
		
		<div data-theme="a" data-role="footer" data-position="fixed">
			<a id="start" class="ui-btn-left" data-icon="arrow-r" href="">Start</a>
			<h3>Tracking</h3>
			<a id="stop" class="ui-btn-right" data-icon="delete" href="">Stopp</a>
		</div>
	</div>

	
	<div data-role="page" id="page2">
		<div data-theme="a" data-role="header">
			<a data-rel="back" data-ajax="false" data-icon="arrow-l">Tilbake</a>
			<h3>Page Header</h3>
		</div>
		
		<div data-role="content" id="content2">
			content...
		</div>
		
		<div data-theme="a" data-role="footer" data-position="fixed">
			<h3>Page Footer</h3>
		</div>
	</div>	
	
</body>

</html>

